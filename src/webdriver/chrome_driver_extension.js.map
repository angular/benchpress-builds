{"version":3,"file":"chrome_driver_extension.js","sourceRoot":"/home/travis/build/angular/angular/packages/benchpress/","sources":["src/webdriver/chrome_driver_extension.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {Inject, Injectable, StaticProvider} from '@angular/core';\n\nimport {Options} from '../common_options';\nimport {WebDriverAdapter} from '../web_driver_adapter';\nimport {PerfLogEvent, PerfLogFeatures, WebDriverExtension} from '../web_driver_extension';\n\n/**\n * Set the following 'traceCategories' to collect metrics in Chrome:\n * 'v8,blink.console,disabled-by-default-devtools.timeline,devtools.timeline,blink.user_timing'\n *\n * In order to collect the frame rate related metrics, add 'benchmark'\n * to the list above.\n */\n@Injectable()\nexport class ChromeDriverExtension extends WebDriverExtension {\n  static PROVIDERS = <StaticProvider>[{\n    provide: ChromeDriverExtension,\n    deps: [WebDriverAdapter, Options.USER_AGENT]\n  }];\n\n  private _majorChromeVersion: number;\n  private _firstRun = true;\n\n  constructor(private _driver: WebDriverAdapter, @Inject(Options.USER_AGENT) userAgent: string) {\n    super();\n    this._majorChromeVersion = this._parseChromeVersion(userAgent);\n  }\n\n  private _parseChromeVersion(userAgent: string): number {\n    if (!userAgent) {\n      return -1;\n    }\n    let v = userAgent.split(/Chrom(e|ium)\\//g)[2];\n    if (!v) {\n      return -1;\n    }\n    v = v.split('.')[0];\n    if (!v) {\n      return -1;\n    }\n    return parseInt(v, 10);\n  }\n\n  gc() { return this._driver.executeScript('window.gc()'); }\n\n  timeBegin(name: string): Promise<any> {\n    if (this._firstRun) {\n      this._firstRun = false;\n      // Before the first run, read out the existing performance logs\n      // so that the chrome buffer does not fill up.\n      this._driver.logs('performance');\n    }\n    return this._driver.executeScript(`console.time('${name}');`);\n  }\n\n  timeEnd(name: string, restartName: string|null = null): Promise<any> {\n    let script = `console.timeEnd('${name}');`;\n    if (restartName) {\n      script += `console.time('${restartName}');`;\n    }\n    return this._driver.executeScript(script);\n  }\n\n  // See [Chrome Trace Event\n  // Format](https://docs.google.com/document/d/1CvAClvFfyA5R-PhYUmn5OOQtYMH4h6I0nSsKchNAySU/edit)\n  readPerfLog(): Promise<PerfLogEvent[]> {\n    // TODO(tbosch): Chromedriver bug https://code.google.com/p/chromedriver/issues/detail?id=1098\n    // Need to execute at least one command so that the browser logs can be read out!\n    return this._driver.executeScript('1+1')\n        .then((_) => this._driver.logs('performance'))\n        .then((entries) => {\n          const events: PerfLogEvent[] = [];\n          entries.forEach((entry: any) => {\n            const message = JSON.parse(entry['message'])['message'];\n            if (message['method'] === 'Tracing.dataCollected') {\n              events.push(message['params']);\n            }\n            if (message['method'] === 'Tracing.bufferUsage') {\n              throw new Error('The DevTools trace buffer filled during the test!');\n            }\n          });\n          return this._convertPerfRecordsToEvents(events);\n        });\n  }\n\n  private _convertPerfRecordsToEvents(\n      chromeEvents: Array<{[key: string]: any}>, normalizedEvents: PerfLogEvent[]|null = null) {\n    if (!normalizedEvents) {\n      normalizedEvents = [];\n    }\n    chromeEvents.forEach((event) => {\n      const categories = this._parseCategories(event['cat']);\n      const normalizedEvent = this._convertEvent(event, categories);\n      if (normalizedEvent != null) normalizedEvents !.push(normalizedEvent);\n    });\n    return normalizedEvents;\n  }\n\n  private _convertEvent(event: {[key: string]: any}, categories: string[]) {\n    const name = event['name'];\n    const args = event['args'];\n    if (this._isEvent(categories, name, ['blink.console'])) {\n      return normalizeEvent(event, {'name': name});\n    } else if (this._isEvent(\n                   categories, name, ['benchmark'],\n                   'BenchmarkInstrumentation::ImplThreadRenderingStats')) {\n      // TODO(goderbauer): Instead of BenchmarkInstrumentation::ImplThreadRenderingStats the\n      // following events should be used (if available) for more accurate measurements:\n      //   1st choice: vsync_before - ground truth on Android\n      //   2nd choice: BenchmarkInstrumentation::DisplayRenderingStats - available on systems with\n      //               new surfaces framework (not broadly enabled yet)\n      //   3rd choice: BenchmarkInstrumentation::ImplThreadRenderingStats - fallback event that is\n      //               always available if something is rendered\n      const frameCount = event['args']['data']['frame_count'];\n      if (frameCount > 1) {\n        throw new Error('multi-frame render stats not supported');\n      }\n      if (frameCount == 1) {\n        return normalizeEvent(event, {'name': 'frame'});\n      }\n    } else if (\n        this._isEvent(categories, name, ['disabled-by-default-devtools.timeline'], 'Rasterize') ||\n        this._isEvent(\n            categories, name, ['disabled-by-default-devtools.timeline'], 'CompositeLayers')) {\n      return normalizeEvent(event, {'name': 'render'});\n    } else if (this._isEvent(categories, name, ['devtools.timeline', 'v8'], 'MajorGC')) {\n      const normArgs = {\n        'majorGc': true,\n        'usedHeapSize': args['usedHeapSizeAfter'] !== undefined ? args['usedHeapSizeAfter'] :\n                                                                  args['usedHeapSizeBefore']\n      };\n      return normalizeEvent(event, {'name': 'gc', 'args': normArgs});\n    } else if (this._isEvent(categories, name, ['devtools.timeline', 'v8'], 'MinorGC')) {\n      const normArgs = {\n        'majorGc': false,\n        'usedHeapSize': args['usedHeapSizeAfter'] !== undefined ? args['usedHeapSizeAfter'] :\n                                                                  args['usedHeapSizeBefore']\n      };\n      return normalizeEvent(event, {'name': 'gc', 'args': normArgs});\n    } else if (\n        this._isEvent(categories, name, ['devtools.timeline'], 'FunctionCall') &&\n        (!args || !args['data'] ||\n         (args['data']['scriptName'] !== 'InjectedScript' && args['data']['scriptName'] !== ''))) {\n      return normalizeEvent(event, {'name': 'script'});\n    } else if (this._isEvent(categories, name, ['devtools.timeline'], 'EvaluateScript')) {\n      return normalizeEvent(event, {'name': 'script'});\n    } else if (this._isEvent(\n                   categories, name, ['devtools.timeline', 'blink'], 'UpdateLayoutTree')) {\n      return normalizeEvent(event, {'name': 'render'});\n    } else if (\n        this._isEvent(categories, name, ['devtools.timeline'], 'UpdateLayerTree') ||\n        this._isEvent(categories, name, ['devtools.timeline'], 'Layout') ||\n        this._isEvent(categories, name, ['devtools.timeline'], 'Paint')) {\n      return normalizeEvent(event, {'name': 'render'});\n    } else if (this._isEvent(categories, name, ['devtools.timeline'], 'ResourceReceivedData')) {\n      const normArgs = {'encodedDataLength': args['data']['encodedDataLength']};\n      return normalizeEvent(event, {'name': 'receivedData', 'args': normArgs});\n    } else if (this._isEvent(categories, name, ['devtools.timeline'], 'ResourceSendRequest')) {\n      const data = args['data'];\n      const normArgs = {'url': data['url'], 'method': data['requestMethod']};\n      return normalizeEvent(event, {'name': 'sendRequest', 'args': normArgs});\n    } else if (this._isEvent(categories, name, ['blink.user_timing'], 'navigationStart')) {\n      return normalizeEvent(event, {'name': 'navigationStart'});\n    }\n    return null;  // nothing useful in this event\n  }\n\n  private _parseCategories(categories: string): string[] { return categories.split(','); }\n\n  private _isEvent(\n      eventCategories: string[], eventName: string, expectedCategories: string[],\n      expectedName: string|null = null): boolean {\n    const hasCategories = expectedCategories.reduce(\n        (value, cat) => value && eventCategories.indexOf(cat) !== -1, true);\n    return !expectedName ? hasCategories : hasCategories && eventName === expectedName;\n  }\n\n  perfLogFeatures(): PerfLogFeatures {\n    return new PerfLogFeatures({render: true, gc: true, frameCapture: true, userTiming: true});\n  }\n\n  supports(capabilities: {[key: string]: any}): boolean {\n    return this._majorChromeVersion >= 44 && capabilities['browserName'].toLowerCase() === 'chrome';\n  }\n}\n\nfunction normalizeEvent(chromeEvent: {[key: string]: any}, data: PerfLogEvent): PerfLogEvent {\n  let ph = chromeEvent['ph'].toUpperCase();\n  if (ph === 'S') {\n    ph = 'B';\n  } else if (ph === 'F') {\n    ph = 'E';\n  } else if (ph === 'R') {\n    // mark events from navigation timing\n    ph = 'I';\n  }\n  const result: {[key: string]: any} =\n      {'pid': chromeEvent['pid'], 'ph': ph, 'cat': 'timeline', 'ts': chromeEvent['ts'] / 1000};\n  if (ph === 'X') {\n    let dur = chromeEvent['dur'];\n    if (dur === undefined) {\n      dur = chromeEvent['tdur'];\n    }\n    result['dur'] = !dur ? 0.0 : dur / 1000;\n  }\n  for (const prop in data) {\n    result[prop] = data[prop];\n  }\n  return result;\n}\n"]}